# 反射机制

## 反射机制概述

  - 反射是动态语言的关键，允许程序在执行期间借助Reflection API取得任何类的内部信息，并能直接操作任意对象的内部属性及方法
  - Java不是动态语言，但有一定的动态性，可以利用反射机制、字节码操作获得类似动态语言的特性
  - 反射机制的功能：
    - 在运行时判断任意一个对象所属的类
    - 在运行时构造任意一个类的对象
    - 在运行时判断任意一个类具有的成员变量和方法
    - 在运行时获取泛型信息
    - 在运行时调用任意一个对象的成员变量和方法
    - 在运行时处理注解
    - 生成动态代理
  - 反射的主要API：
    - java.lang.Class：代表一个类
    - java.lang.reflect.Method：代表类的方法
    - java.lang.reflect.Field：代表类的成员变量
    - java.lang.reflect.Constructor：代表类的构造器
    
## Class类

  - Class类的概述：
    - Class本身也是一个类
    - 一个加载的类在JVM中只会有一个Class实例，对应的是.class文件
    - 通过Class可以获取一个类中所有被加载的结构
    - Class类是反射的根源，需要首先获取Class对象
  - Class类的常用方法：
    - static Class forName(String name)：返回指定类名的Class对象
    - Object newInstance()：返回该Class对象的一个实例
    - getClassLoader()：返回该类的类加载器
    - Constructor[] getConstructors()：返回Consructor对象的数组
    - Field[] getDeclaredFields()：返回Field对象的数组
    - Method getMethod()：返回一个Method对象
  - 获取Class对象的实例：
    - Class clazz = String.class;
    - Class clazz = 类对象.getClass();
    - Class clazz = Class.forName("java.lang.String");
    
## 类的加载

  - 类的加载过程：
    - 加载：类加载器将class文件字节码加载到内存中，并将静态数据转换成方法区的运行时数据结构，然后生成一个代表这个类的java.lang.Class对象，作为方法区中类数据的访问入口。
    - 链接：将Java类的二进制代码合并到JVM的运行状态之中
      - 验证：确保加载的类信息符合JVM规范
      - 准备：为类变量（static）分配内存，并设置类变量默认初始值
      - 解析：JVM常量池的符号引用替换为直接引用
    - 初始化：
      - 执行类构造器<clinit>方法
      - 如果父类还没有初始化，则先初始化父类
  - 类加载器：
    - 作用是把类加载到内存
    - 加载器分类：
      - Bootstrap类加载器：负责Java平台核心库，用来装载核心类库
      - Extension类加载器：负责jre/lib/ext目录下的jar包装载到工作库
      - System类加载器：负责java -classpath目录下的类与jar包装载工作
      
## 创建运行时类的对象
    
    
