# 网络编程

## 网络编程概述

  - 网络编程的目的：直接或间接地通过网络协议与其它计算机实现数据交换，进行通信
  - 主要问题：
    - 如何准确定位网络上的一台或多台主机，定位主机上的特定应用
    - 找到主机后如何可靠高效地进行数据传输

## 网络通信要素

  - 通信双方地址：
    - IP(InetAddress)：
      - 唯一标识Internet上的计算机（通信实体）
      - IP地址分类：
        - IPV4, IPV6
        - 公网地址和私有地址
    - InetAddress类：
      - 两种方式表示地址：
        - 域名（hostname）：www.baidu.com
        - IP地址：100.102.35.99
      - 当使用主机的域名连接网络时，域名服务器（DNS）负责将域名转化为IP地址，然后才能和主机建立连接，这个过程是域名解析
    - Port：端口号
      - 标识正在计算机运行的进程，不同的进程有不同的端口号
      - 端口分类：
        - 公认端口：0~1023，被预先定义的服务通信占用
        - 注册端口：1024~49151，分配给用户进程或应用程序
        - 动态/私有端口：49152~65535
  - 网络通信协议：
    - OSI模型：7层，物理层 -> 数据链路层 -> 网络层 -> 传输层 -> 会话层 -> 表示层 -> 应用层
    - TCP/IP模型：物理+数据链路层 -> 网络层 -> 传输层 -> 应用层

## 网络协议

  - TCP/IP协议：
    - 传输控制协议TCP(Transmission Control Protocol)
    - 用户数据报协议UDP(User Datagram Protocol)
  - TCP/IP是一组协议：传输控制协议（TCP）和网络互连协议（IP），IP协议是网络层的主要协议，支持网络互连的数据通信
  - TCP和UDP:
    - TCP协议：
      - 使用TCP前必须建立连接，形成传输数据通道
      - 传输前采用三次握手方式，点对点通信，是可靠的
      - 在连接中可以进行大数据量的传输
      - 传输完成后需要释放连接，效率低
    - UDP协议：
      - 将数据、源、目的地封装成数据报，不需要建立连接
      - 每个数据报的大小限制在64K之内
      - 发送不管对方是否准备好，且接收方收到不会确认，是不可靠的
      - 传输完成无需释放资源，开销小，效率高
  - TCP三次握手：
    - 客户端发送syn报文，并置发送序号为X
    - 服务端发送syn和应答ACK，并置发送序号为Y，ACK=X+1
    - 客户端发送ACK报文，并置发送序号为Z，ACK=Y+1
  - TCP四次握手：
    - 主动方发送Fin+Ack报文，并置发送序号为X
    - 被动方发送ACK报文，并置发送序号为Z，ACK=X+1
    - 被动方发送Fin+Ack报文，并置发送序号为Y，ACK=X
    - 主动方发送ACK报文，并置发送序号为X，ACK=Y
  - Socket：
    - IP地址和端口号组合在一起构成唯一标识符套接字
    - 通信的两端都要有Socket，网络通信实际就是Socket之间的通信，数据在两个Socket之间通过IO传输
    - 一般主动发起通信的程序是客户端，等待通信请求的是服务端
    - Socket分类：
      - 流套接字（stream socket）：使用TCP提供可靠的字节流服务
      - 数据报套接字（datagram socket）：使用UDP提供“尽力而为”的数据报服务

## TCP网络编程

  - 客户端Socket的工作过程：
    - 创建Socket：根据服务端的IP地址和端口号构造Socket类对象，如果服务端响应，则建立客户端到服务端的通信线路
      - Socket(String host, int port)
    - 打开连接到Socket的输入/输出流：使用getInputStream()获得输入流，getOutputStream()获得输出流，进行数据传输
    - 按照一定的协议对Socket进行读写操作
    - 关闭Socket：断开客户端到服务端的连接，释放连接
  - 服务端的工作过程：
    - 调用ServerSocket(int port)：创建一个服务端套接字，并绑定到指定的端口，用于监听客户端的请求
    - 调用accept()：监听连接请求，如果客户端请求连接则接受连接，返回通信套接字对象
    - 调用该Socket对象的getOutputStream()和getInputStream()获取输出流和输入流，开始网络数据的发送和接收
    - 关闭ServerSocket和Socket对象：客户端访问结束，关闭套接字

