# ZooKeeper概述

  - ZooKeeper是一个开源的分布式的，为分布式应用提供协调服务的Apache项目。
  - 从设计模式角度来理解：ZooKeeper是一个基于观察者模式设计的分布式服务管理框架，它负责存储和管理大家都关心的数据, 然后接受观察者的注册，一旦这些数据的状态发生变化，ZooKeeper就将负责通知已经注册的那些观察者做出相应的反应，从而实现集群中类似Master/Slave管理模式。
  - ZooKeeper = 文件系统 + 通知机制。
  
## 应用场景

  - 分布式消息同步和协调机制
  
  ![数据发布与订阅](./图片/数据发布与订阅.PNG)
  - 服务器节点动态上下线
  - 统一配置管理
  - 软负载均衡
  
  ![软负载均衡](./图片/软负载均衡.PNG)
  - 集群管理
  
  ![集群管理](./图片/集群管理.PNG)

## 数据结构

  - ZooKeeper数据模型的结构与Unix文件系统很类似，整体上可以看作是一棵树，每个节点称做一个Znode。
  - 每一个Znode默认能够存储1MB的数据，每个Znode都可以通过其路径唯一标识。
  
## 节点类型

  - Znode有两种类型：
    - 短暂（ephemeral）：客户端和服务器端断开连接后，创建的节点自己删除。
    - 持久（persistent）：客户端和服务器端断开连接后，创建的节点不删除。
  - Znode有四种形式的目录节点（默认是persistent ）：
    - 持久化目录节点（PERSISTENT）。
    - 持久化顺序编号目录节点（PERSISTENT_SEQUENTIAL）：ZooKeeper给该节点名称进行顺序编号。
    - 临时目录节点（EPHEMERAL）。
    - 临时顺序编号目录节点（EPHEMERAL_SEQUENTIAL）。
  - 创建Znode时设置顺序标识，Znode名称后会附加一个顺序值，顺序值是一个单调递增的计数器，由父节点维护。
  - 在分布式系统中，顺序号可以被用于为所有的事件进行全局排序，这样客户端可以通过顺序号推断事件的顺序。
  
## 特点

  - ZooKeeper: 一个领导者（leader），多个跟随者（follower）组成的集群。
  - Leader负责进行投票的发起和决议，更新系统状态。
  - Follower用于接收客户请求并向客户端返回结果，在选举Leader过程中参与投票。
  - 集群中只要有半数以上节点存活，ZooKeeper集群就能正常服务。
  - 全局数据一致：每个server保存一份相同的数据副本，client无论连接到哪个server，数据都是一致的。
  - 更新请求顺序进行，来自同一个client的更新请求按其发送顺序依次执行。
  - 数据更新原子性，一次数据更新要么成功，要么失败。
  - 实时性：在一定时间范围内，client能读到最新数据。
  
## 选举机制
